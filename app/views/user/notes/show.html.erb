<h1>ノート</h1>

 <%= render 'data', note:@note, tags:@tags %>


<div>
<% if @note.user == current_user %>
  <%= link_to edit_note_path(@note.id), class:"btn btn-sm btn-success" do %>
  <i class="fa-regular fa-pen-to-square"> 編集</i>
  <% end %>|
  <%= link_to note_path(@note.id), class:"btn btn-sm btn-danger text-light", method: :delete, "data-confirm" => "本当に削除しますか？" do %>
  <i class="fa-regular fa-trash-can"> 削除</i>
  <% end %>
<% end %>
</div>

<table>
  <thead>
    <% if user_signed_in? %>
        <th>
          <% if @note.favorited_by?(current_user) %>
            <%= link_to note_note_favorites_path(@note), method: :delete do %>
              <i class="fa-solid fa-heart"></i><%= @note.note_favorites.count %>
            <% end %>
          <% else %>
            <%= link_to note_note_favorites_path(@note), method: :post do %>
              <i class="fa-regular fa-heart"></i><%= @note.note_favorites.count %>
            <% end %>
          <% end %>
        <th><i class="fa-solid fa-comment"></i> <%= @note.comments.count %></th>
        <th><%= link_to "報告", new_report_path(note_id: @note.id), class:"btn btn-sm btn-warning" %></th>
        </th>
      <% else %>
        <th><i class="fa-solid fa-heart"></i><%= @note.note_favorites.count %></th>
      <th><i class="fa-solid fa-comment"></i> <%= @note.comments.count %></th>
      <% end %>
  </thead>
  <% @note.comments.each do |comment| %>
  <tbody>
    <td><%= comment.created_at.strftime('%Y/%m/%d') %></td>
    <td><%= comment.user.name %></td>
    <td></td>
    <td><%= comment.text %></td>
        <% if user_signed_in? %>
    <td><%= link_to "報告", new_report_path(comment_id: comment.id), class:"btn btn-sm btn-warning" %></td>
        <% end %>

    <td>
      <% if comment.user == current_user %>
        <%= link_to note_comment_path(comment.note, comment), method: :delete, class:"btn btn-sm btn-danger" do %>
        <i class="fa-regular fa-trash-can"> 削除</i>
        <% end %>
      <% end %>
    </td>
  </tbody>
  <% end %>
</table>

<% if user_signed_in? %>
  <div>
    <%= form_with model: [@note, @comment] do |f| %>
      <%= f.text_area :text, rows: '7', placeholder: "コメント", class:"form-control" %>
      <%= f.submit "送信", class:"btn btn-sm btn-secondary" %>
    <% end %>
  </div>

<% end %>
